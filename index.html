<!DOCTYPE html>
<html>
    <head>
        <title>Duck Address Send Generator</title>
        <link rel="icon" href="favicon.ico" type="image/x-icon">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="container">
            <h1>Duck Address Sending Generator ðŸ¦†</h1>
            <h3>Did you know that you can send FROM duck addresses? All you have to do is put in the info and then send the email from your PERSONAL address to the special created one!</h3>

            <div style="display: flex; flex-direction: column;">
                <label for="textbox1">Address to send TO:</label>
                <input type="email" id="textbox1" name="textbox1" placeholder="john@example.com">
                <label for="textbox2">Address to send FROM:</label>
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <input type="email" id="textbox2" name="textbox2" placeholder="tim@duck.com">
                    <button style="background-color: #ccc; border: none; width: 30px; height: 30px; margin-left: 5px;" onclick="openPopup()"></button>

                    <div id="popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #fff; padding: 20px; border-radius: 5px;">
                            <h2>DDG Api Key:</h2>
                            <input type="text" id="popupInput">
                            <button onclick="closePopup()">OK</button>
                        </div>
                    </div>

                    </div>                
                <button onclick="combineText()">Create Address!</button>
                

            <div style="display: flex; flex-direction: column; align-items: center;" hidden>
                <p id="combinedText" style="font-size: 24px; font-weight: bold; color: #333; margin-top: 20px; text-align: center;"></p>
                <button id="copyButton" onclick="copyToClipboard()" style="margin-top: 20px; background-color: #007bff; color: #fff; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer; text-align: center;" hidden>Copy to clipboard</button>
                <button id="mailButton" onclick="sendEmail()" style="margin-top: 20px; background-color: #007bff; color: #fff; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer; text-align: center;" hidden>Open in Mail</button>
            </div>

        </div>
        <script>
            function combineText() {
                var textbox1Value = document.getElementById("textbox1").value;
                var textbox2Value = document.getElementById("textbox2").value;
                var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                var duckEmailRegex = /^[^\s@]+@duck\.com$/;

                if (!emailRegex.test(textbox1Value)) {
                    alert("Please enter a valid email address");
                    return false;
                }
                if (!duckEmailRegex.test(textbox2Value)){
                    alert("Please enter a valid duck address");
                    return false;
                }
                var textbox1Parts = textbox1Value.split("@");
                var combinedText = textbox1Parts[0] + "_at_" + textbox1Parts[1] + "_" + textbox2Value;
                document.getElementById("combinedText").innerHTML = combinedText;
                document.getElementById("copyButton").removeAttribute("hidden");
                document.getElementById("mailButton").removeAttribute("hidden");
            }

            function copyToClipboard() {
                var combinedText = document.getElementById("combinedText");
                var range = document.createRange();
                range.selectNode(combinedText);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand("copy");
                window.getSelection().removeAllRanges();
                alert("Copied to clipboard!");
            }

            function sendEmail() {
                const combinedText = document.getElementById("combinedText").textContent;
                const mailtoLink = `mailto:${combinedText}`;
                window.location.href = mailtoLink;
            }

            function openPopup() {
                document.getElementById("popup").style.display = "block";
            }

            async function closePopup() {
                const popupInput = document.getElementById("popupInput").value;

                if (popupInput == null || popupInput === "") {
                    throw "Invalid DuckDuckGo API token.";
                }

                const requestInit = {
                    redirect: "manual",
                    cache: "no-store",
                    method: "POST",
                    headers: new Headers({
                    Authorization: "Bearer " + popupInput,
                    "Content-Type": "application/json",
                    }),
                };

                const url = "https://quack.duckduckgo.com/api/email/addresses";
                const request = new Request(url, requestInit);

                try {
                    const response = await fetch(request);

                    if (response.status === 200 || response.status === 201) {
                    const json = await response.json();
                    if (json.address) {
                        alert(`${json.address}@duck.com`);
                        document.getElementById("textbox2").value = "happy";
                        document.getElementById("popup").style.display = "none";
                    }
                    } else if (response.status === 401) {
                    throw "Invalid DuckDuckGo API token.";
                    } else {
                    throw "Unknown DuckDuckGo error occurred.";
                    }
                } catch (error) {
                    console.error(error);
                }
                }

        </script>
        <footer>
            <button onclick="window.location.href='./help.html'" style="border-radius: 55px; background-color: #ff4d4d;">HELP!</button>
            <p>Made with ðŸ’– by <a href="https://github.com/Hamster45105">Hamster45105</a></p>
        </footer>
    </body>
</html>