<!DOCTYPE html>
<html>
    <head>
        <title>DDG Sending Generator | Send emails FROM your duck addresses</title>
        <link rel="icon" href="favicon.ico" type="image/x-icon">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="./styles/style.css">
    </head>
    <body>
        <div class="container">
            <h1>Duck Address Sending Generator ðŸ¦†</h1>
            <h2><i>Send emails from your duck addresses</i></h2>
            <h3>Did you know that you can send FROM duck addresses? Use this tool to help you do it!</h3>

            <div style="display: flex; flex-direction: column;">
                <label for="textbox1">Address to send TO:</label>
                <textarea id="textbox1" name="textbox1" placeholder="john@example.com" rows="1"></textarea>
                <label for="textbox2">Address to send FROM:</label>
                <div style="display: flex; flex-direction: row; align-items: center;">
                    <div style="display: flex; flex-direction: row; align-items: center; flex: 1; justify-content: flex-end;">
                        <input type="email" id="textbox2" name="textbox2" placeholder="tim@duck.com" style="flex-grow: 1;">
                        <button onclick="openPopup()" style="margin-left: 10px; padding: 5px 10px;">ðŸ”„</button>
                    </div>
                    
                    <div id="popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #fff; padding: 20px; border-radius: 5px;">
                            <h2>DDG API Key:</h2>
                            <input type="password" id="popupInput">
                            <div style="display: flex; justify-content: space-between; margin-top: 20px;">
                                <button onclick="closePopup()">OK</button>
                                <button onclick="document.getElementById('popup').style.display = 'none';">Cancel</button>
                            </div>
                        </div>
                    </div>

                    <div id="placeholder_popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #fff; padding: 20px; border-radius: 5px; text-align: center;">
                            <h2>Generate Private Duck Address</h2>
                            <img src="https://img.shields.io/github/stars/Hamster45105/DuckAddressSend?style=for-the-badge&logo=data:image/png;base64,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&label=Current%20star%20count&labelColor=cccabf&color=eac550" alt="Image description">
                            <p>Unfortunately, this feature is disabled until the repository for this website reaches 5 stars.</p>
                            <p>More info in the help section</p>
                            <button onclick="document.getElementById('placeholder_popup').style.display = 'none';">OK</button>
                        </div>
                    </div>

                    <div id="errorPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #fff; padding: 20px; border-radius: 5px; text-align: center; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); animation: fade-in 0.5s ease-out;">
                            <h2 style="color: #ff0000;">Error</h2>
                            <p id="error-message" style="color: #ff0000;">An error occured</p>
                            <button onclick="document.getElementById('errorPopup').style.display = 'none';" style="background-color: #ff0000; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Dismiss</button>
                        </div>
                    </div>

                    <div id="starPopup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 999;">
                        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background-color: #fff; padding: 20px; border-radius: 5px; text-align: center; box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5); animation: fade-in 0.5s ease-out;">
                            <h2 style="color: #000; font-size: 2em;">Give the project a ðŸŒŸ</h2>
                            <p style="color: #000; font-size: 1.2em;">If you like this project, please consider giving it a star on GitHub! This will help us to <a href='https://github.com/Hamster45105/DuckAddressSend/issues/7#issuecomment-1681736743'>re-enable the generate Duck Address feature!</a> </p>
                            <button onclick="window.open('https://github.com/Hamster45105/DuckAddressSend', '_blank'); document.getElementById('starPopup').style.display = 'none';" style="background-color: #008CBA; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer;">Give it a star! ðŸ¤©</button>
                        </div>
                        <button onclick="document.getElementById('starPopup').style.display = 'none';" style="position: absolute; top: 10px; right: 10px; background-color: #fff; color: #000; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer;">Close</button>
                    </div>
                    <style>
                        @keyframes fade-in {
                            from {
                                opacity: 0;
                            }
                            to {
                                opacity: 1;
                            }
                        }
                    </style>
                    

                    </div>                
                <button onclick="combineText()">Create Address!</button>
                

            <div style="display: flex; flex-direction: column; align-items: center;" hidden>
                <p id="combinedText" style="font-size: 24px; font-weight: bold; color: #333; margin-top: 20px; text-align: center;"></p>
                
            </div>
            <div style="display: flex; justify-content: center;">
                <button id="copyButton" onclick="copyToClipboard()" style="margin-top: 20px; background-color: #007bff; color: #fff; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer; text-align: center;" hidden>Copy to Clipboard</button>
                <button id="mailButton" onclick="sendEmail()" style="margin-top: 20px; margin-left: 10px; background-color: #007bff; color: #fff; border: none; border-radius: 5px; padding: 10px 20px; cursor: pointer; text-align: center;" hidden>Open in Mail</button>
            </div>
        </div>
        <script>
            function combineText() {
                var textbox1Value = document.getElementById("textbox1").value;
                var textbox2Value = document.getElementById("textbox2").value;
                var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                var duckEmailRegex = /^[^\s@]+@duck\.com$/;

                if (!emailRegex.test(textbox1Value)) {
                    openErrorPopup("Please enter a valid email address!");
                    return false;
                }

                if (!duckEmailRegex.test(textbox2Value)){
                    openErrorPopup("Please enter a valid duck address!");
                    return false;
                }
                var textbox1Parts = textbox1Value.split("@");
                var combinedText = textbox1Parts[0] + "_at_" + textbox1Parts[1] + "_" + textbox2Value;
                copyButton.style.backgroundColor = "#007bff";
                copyButton.textContent = "Copy to Clipboard";
                document.getElementById("combinedText").innerHTML = combinedText;
                document.getElementById("copyButton").removeAttribute("hidden");
                document.getElementById("mailButton").removeAttribute("hidden");
            }

            function copyToClipboard() {
                var combinedText = document.getElementById("combinedText");
                var range = document.createRange();
                range.selectNode(combinedText);
                window.getSelection().removeAllRanges();
                window.getSelection().addRange(range);
                document.execCommand("copy");
                window.getSelection().removeAllRanges();
                copyButton.style.backgroundColor = "#6fc134";
                copyButton.textContent = "Copied!";    
            }

            function sendEmail() {
                const combinedText = document.getElementById("combinedText").textContent;
                const mailtoLink = `mailto:${combinedText}`;
                window.location.href = mailtoLink;
            }

            function openPopup() {
                // document.getElementById("popupInput").value = localStorage.getItem("apiKey");
                document.getElementById("placeholder_popup").style.display = "block";
            }

            function openErrorPopup(errorMessage) {
                document.getElementById("error-message").innerHTML = errorMessage;
                document.getElementById("errorPopup").style.display = "block";
            }
            

            async function closePopup() {
                const apiKey = document.getElementById("popupInput").value;
                const emailAddresses = await postEmailAddresses(apiKey);
                const duckAddress = emailAddresses.address + "@duck.com";
                document.getElementById("textbox2").value = duckAddress;
                localStorage.setItem("apiKey", apiKey);
                document.getElementById("popup").style.display = "none";
            }

            async function postEmailAddresses(apiKey) {
                const url = "https://quack.duckduckgo.com/api/email/addresses";
                const requestInit = {
                    method: "POST",
                    cache: "no-store",
                    redirect: "manual",
                    headers: {
                    Authorization: `Bearer ${apiKey}`,
                    "Content-Type": "application/json",
                    },
                };
                const corsAnywhereUrl = "https://cors-anywhere.herokuapp.com/" + url;
                const response = await fetch(corsAnywhereUrl, requestInit);
                if (response.status === 401) {
                    openErrorPopup("Invalid DuckDuckGo API Key!");
                    return null;
                }
                const json = await response.json();
                return json;
            } 
            function showStarPopup() {
            if (!localStorage.getItem("popupShown")) {
                document.getElementById("starPopup").style.display = "block";
                localStorage.setItem("popupShown", true);
            }
        }
        window.addEventListener("load", showStarPopup);

        // Keyboard shortcuts
        textbox2.addEventListener("keydown", function(event) {
        if (event.keyCode === 13) {
            combineText();
        }
        });

        textbox1.addEventListener("keydown", function(event) {
        if (event.keyCode === 13) {
            textbox2.focus();
        }
        });
        </script>
        </div>
                <footer>
    <button onclick="window.location.href='https://github.com/Hamster45105/DuckAddressSend/wiki'" style="border-radius: 55px; background-color: #ff4d4d;">HELP!</button>
    <div style="margin-top: 10px;">
        <a href="https://github.com/Hamster45105/DuckAddressSend" target="_blank"><img src="https://img.shields.io/github/stars/Hamster45105/DuckAddressSend?style=social" alt="GitHub"></a>
    </div>
    <p>Made with ðŸ’– by <a href="https://github.com/Hamster45105">Hamster45105</a></p>
    <p>Disclaimer: This website is not made by or an offical service of DuckDuckGo in any way!</p>
</footer>
            </body>
        </html>
    </body>
</html>